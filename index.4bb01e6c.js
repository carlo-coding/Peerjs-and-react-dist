import{j as y,r as i,u as R,l as P,R as w,a as S,b as v,c as M,H as E}from"./vendor.6b2f27e2.js";const b=function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))p(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&p(l)}).observe(document,{childList:!0,subtree:!0});function u(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function p(o){if(o.ep)return;o.ep=!0;const s=u(o);fetch(o.href,s)}};b();const r=y.exports.jsx,f=y.exports.jsxs;function N(){const a=i.exports.useRef(null),c=e=>a.current.srcObject=e,[u,p]=i.exports.useState(""),[o,s]=i.exports.useState(null),[l,g]=i.exports.useState([]),n=e=>g([...l,e]),d=()=>{if(!o)return;n(`Connecting to ${u}...`);let e=o.connect(u);e==null||e.on("data",t=>{n(`received: ${t}`)}),e==null||e.on("open",()=>{e.send("hi!")}),navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{o.call(u,t).on("stream",c)}).catch(t=>{console.log("Failed to get local stream",t)})};return i.exports.useEffect(()=>s(new Peer({host:"localhost",port:"4005",path:"/peerjs/myapp"})),[]),i.exports.useEffect(()=>{!o||(o.on("open",e=>{console.log("connection opened ..."),n("My peer id is: "+e)}),o.on("error",e=>console.log("Error: Lost connection to server.")),o.on("connection",e=>{n("incoming peer connection!"),e.on("data",t=>{n(`received: ${t}`)}),e.on("open",()=>{e.send("Hello!")})}),o.on("call",e=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{e.answer(t),e.on("stream",c)}).catch(t=>{console.log("Failed to get local stream",t)})}))},[o]),f("div",{className:"App",children:[r("div",{id:"video-grid"}),r("video",{ref:a,className:"remote-video",autoPlay:!0}),r("input",{placeholder:"Enter peer id: ",value:u,onChange:e=>p(e.target.value)}),r("button",{onClick:d,children:"Connect to peer"}),r("div",{className:"messages",children:l.map((e,t)=>r("div",{children:e},t))})]})}const O=()=>Math.random().toString(16).slice(2);function $({stream:a}){const c=i.exports.useRef(null);return i.exports.useEffect(()=>{c.current.srcObject=a},[]),r("video",{ref:c,autoPlay:!0})}function j(){const a=R(),[c,u]=i.exports.useState(""),[p,o]=i.exports.useState([]),s=i.exports.useRef(null);function l(n){let d=O();return o(e=>[...e,{stream:n,id:d}]),d}function g(n){o(d=>d.filter(e=>e.id!==n))}return i.exports.useEffect(()=>{(async()=>{if(a.roomId)return;const t=await(await fetch("https://peer-connection-dx8mf.ondigitalocean.app/create/room")).json();u(t.id)})();const n=P("wss://peer-connection-dx8mf.ondigitalocean.app/"),d=new Peer({host:"peer-connection-dx8mf.ondigitalocean.app",path:"/peerjs/myapp"});d.on("open",t=>{n.emit("join-room",a.roomId?a.roomId:c,t)});function e(t,m){const h=d.call(t,m);let x="";h.on("stream",I=>{x=l(I)}),h.on("close",()=>{g(x)})}navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(t=>{l(t),d.on("call",m=>{m.answer(t),m.on("stream",h=>{l(h)})}),n.on("user-connected",m=>{console.log("new user connected",m),e(m,t)})})},[]),f("div",{children:[!a.roomId&&f(w.Fragment,{children:[r("p",{children:"your room url"}),f("a",{href:`http://${window.location.host}/#/room/${c}`,children:["http://",window.location.host,"/#/room/",c]})]}),r("div",{id:"video-grid",ref:s,children:p==null?void 0:p.map(n=>r($,{stream:n==null?void 0:n.stream},n==null?void 0:n.id))})]})}function L(){return r("div",{className:"App",children:f(S,{children:[r(v,{path:"/peer",element:r(N,{})}),r(v,{path:"/room/:roomId",element:r(j,{})}),r(v,{path:"/",element:r(j,{})})]})})}M.render(r(E,{children:r(w.StrictMode,{children:r(L,{})})}),document.getElementById("root"));
